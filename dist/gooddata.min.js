(function(window,e){"function"==typeof define&&define.amd?define(e):"object"==typeof exports?module.exports=e():window.gooddata=e()})(this,function(){var e,t;return function(){var r={},n={};e=function(e,t,n){r[e]={deps:t,callback:n}},t=function(e){function i(t){if("."!==t.charAt(0))return t;for(var r=t.split("/"),n=e.split("/").slice(0,-1),i=0,o=r.length;o>i;i++){var a=r[i];if(".."===a)n.pop();else{if("."===a)continue;n.push(a)}}return n.join("/")}if(n[e])return n[e];if(n[e]={},!r[e])throw Error("Could not find module "+e);for(var o,a=r[e],u=a.deps,c=a.callback,s=[],f=0,l=u.length;l>f;f++)"exports"===u[f]?s.push(o={}):s.push(t(i(u[f])));var d=c.apply(this,s);return n[e]=o||d},t.entries=r}(),e("loader",function(){}),e("_jquery",[],function(){if("undefined"==typeof $)throw Error("You need to include jQuery to use Gooddata JS");return window.$}),e("xhr",["_jquery"],function(e){var t,r,n={},i=function(e,t){n.ajax(e).done(function(e,r,n){t.resolve(e,r,n)}).fail(function(e,r,n){t.reject(e,r,n)})},o=function(e,r){t.done(function(){i(e,r)}).fail(function(e,t,n){401!==e.status&&r.reject(e,t,n)})},a=function(r,n){t||(t=e.ajax("/gdc/account/token/").always(function(){t=null}).fail(function(t,i,o){return 401===t.status&&e.isFunction(r.unauthorized)?(r.unauthorized(t),void 0):(n.reject(t,i,o),void 0)})),o(r,n)},u=function(e,t){setTimeout(function(){i(e,t)},e.pollDelay)},c=function(t,r,n){var i=t[r];delete t[r],e.isFunction(i)&&n(i),e.isArray(i)&&i.forEach(function(t){e.isFunction(i)&&n(t)})};n.ajaxSetup=function(t){r=e.extend({contentType:"application/json",dataType:"json",pollDelay:1e3},t)},n.ajax=function(n,i){e.isPlainObject(n)&&(i=n,n=void 0),i=e.extend({},r,i),n&&(i.url=n),e.isPlainObject(i.data)&&(i.data=JSON.stringify(i.data));var s=e.Deferred();return c(i,"success",s.done),c(i,"error",s.fail),c(i,"complete",s.always),t?(o(i,s),s):(e.ajax(i).fail(function(e,t,r){401===e.status?a(i,s):s.reject(e,t,r)}).done(function(e,t,r){202===r.status?u(i,s):s.resolve(e,t,r)}),s)};var s=function s(t){return function(r,i){var o=e.extend(!0,{method:t},i);return n.ajax(r,o)}};return n.get=s("GET"),n.post=s("POST"),n.put=s("PUT"),n.ajaxSetup({}),n}),e("sdk",["./xhr"],function(e){var t={reportDefinition:{content:{filters:[],format:"grid",grid:{rows:[],columns:[],sort:{columns:[],rows:[]},columnWidths:[],metrics:[]}},meta:{title:"Test",summary:"",tags:"",deprecated:0,category:"reportDefinition"}}},r=[{r:43,g:107,b:174},{r:105,g:170,b:81},{r:238,g:177,b:76},{r:213,g:60,b:56},{r:137,g:77,b:148},{r:115,g:115,b:115},{r:68,g:169,b:190},{r:150,g:189,b:95},{r:253,g:147,b:105},{r:225,g:93,b:134},{r:124,g:111,b:173},{r:165,g:165,b:165},{r:122,g:166,b:213},{r:130,g:208,b:141},{r:255,g:210,b:137},{r:241,g:132,b:128},{r:191,g:144,b:198},{r:191,g:191,b:191}],n=function(e){var r=e.filter(function(e){return"metric"===e.type}),n=e.filter(function(e){return"attribute"===e.type}),i=$.extend(!0,{},t),o=i.reportDefinition.content.grid;return o.metrics=r.map(function(e){return{uri:e.uri,alias:""}}),o.columns=n.map(function(e){return{attribute:{alias:"",totals:[[],[]],uri:e.uri}}}).concat(r.length?["metricGroup"]:[]),i},i=function(){return $.getJSON("/gdc/account/token")},o=function(t,r){var n=$.Deferred();return e.post("/gdc/account/login",{data:JSON.stringify({postUserLogin:{login:t,password:r,remember:1,captcha:"",verifyCaptcha:""}})}).then(n.resolve,n.reject),n.promise()},a=function(){var t=$.Deferred();return i().then(function(){return e.get("/gdc/app/account/bootstrap").then(function(e){var t=e.bootstrapResource.accountSetting.links.self,r=t.match(/([^\/]+)\/?$/)[1];return r},t.reject)},t.resolve).then(function(t){return e.ajax("/gdc/account/login/"+t,{method:"delete"})}).then(t.resolve,t.reject),t.promise()},u=function(t){var r=$.Deferred();return e.get("/gdc/account/profile/"+t+"/projects").then(function(e){r.resolve(e.projects.map(function(e){return e.project}))},r.reject),r.promise()},c=function(t){var r=$.Deferred();return e.get("/gdc/md/"+t+"/query/datasets").then(function(e){r.resolve(e.query.entries)},r.reject),r.promise()},s=function(t){var n=$.Deferred();return e.get("/gdc/projects/"+t+"/styleSettings").then(function(e){n.resolve(e.styleSettings.chartPalette.map(function(e){return{r:e.fill.r,g:e.fill.g,b:e.fill.b}}))},function(e){200===e.status&&n.resolve(r),n.reject(e)}),n.promise()},f=function(t,r){var n=$.Deferred();return e.put("/gdc/projects/"+t+"/styleSettings",{data:{styleSettings:{chartPalette:r.map(function(e,t){return{guid:"guid"+t,fill:e}})}}}).then(n.resolve,n.reject),n.promise()},l=function(t,r){var n={execution:{columns:r}},i={isLoaded:!1},o=$.Deferred();return e.post("/gdc/internal/projects/"+t+"/experimental/executions",{data:JSON.stringify(n)},o.reject).then(function(t){return i.headers=t.executionResult.columns.map(function(e){return e.attributeDisplayForm?{type:"attrLabel",id:e.attributeDisplayForm.meta.identifier,uri:e.attributeDisplayForm.meta.uri,title:e.attributeDisplayForm.meta.title}:{type:"metric",id:e.metric.meta.identifier,title:e.metric.meta.title,format:e.metric.content.format}}),e.ajax(t.executionResult.tabularDataResult)},o.reject).then(function(e){i.rawData=e.tabularDataResult.values,i.isLoaded=!0,o.resolve(i)},o.reject),o.promise()},d=function(t){var r=$.Deferred();return e.get("/gdc/md/"+t+"/query/attributes").then(function(e){r.resolve(e.query.entries)},r.reject),r.promise()},p=function(t){var r=$.Deferred();return e.get("/gdc/md/"+t+"/query/dimensions").then(function(e){r.resolve(e.query.entries)},r.reject),r.promise()},m=function(t,r){var n=function(t,r){var n=$.Deferred(),i=r?"?type="+r:"";return e.get("/gdc/md/"+t+"/query/folders"+i).then(function(e){n.resolve(e.query.entries)},n.reject),n.promise()};switch(r){case"fact":case"metric":return n(t,r);case"attribute":return p(t);default:var i=$.Deferred();return $.when(n(t,"fact"),n(t,"metric"),p(t)).done(function(e,t,r){i.resolve({fact:e,metric:t,attribute:r})}),i.promise()}},g=function(e,t){var r=$.Deferred();return m(e,t).then(function(n){var i=function(e){var t=$.Deferred();return $.when.apply(this,e.map(D)).then(function(){var e=Array.prototype.slice.call(arguments).map(function(e){return e.metric});t.resolve(e)},t.reject),t.promise()},o=function(e,t){return e.map(function(e){return e[t]})},a=o(n,"link"),u=o(n,"title");$.when.apply(this,a.map(D)).then(function(){var n=Array.prototype.slice.call(arguments);if("attribute"===t)d(e).then(function(e){var t=[];n.forEach(function(e){e.dimension.content.attributes.forEach(function(e){t.push(e.meta.uri)})});var i=e.filter(function(e){return-1===t.indexOf(e.link)}).map(function(e){return e.link});$.when.apply(this,i.map(D)).then(function(){var e=Array.prototype.slice.call(arguments).map(function(e){return e.attribute}),t=n.map(function(e){return{title:e.dimension.meta.title,items:e.dimension.content.attributes}});t.push({title:"Unsorted",items:e}),r.resolve(t)})});else if("metric"===t){var a=n.map(function(e){return o(e.folder.content.entries,"link")});v(e).then(function(e){var t=[];n.forEach(function(e){e.folder.content.entries.forEach(function(e){t.push(e.link)})});var o=e.filter(function(e){return-1===t.indexOf(e.link)}).map(function(e){return e.link});a.push([o]),$.when.apply(this,a.map(function(e){return i(e)})).then(function(){var e=Array.prototype.slice.call(arguments),t=e.map(function(e,t){return{title:u[t]||"Unsorted",items:e}});r.resolve(t)},r.reject)})}else r.reject()})},r.reject),r.promise()},v=function(t){var r=$.Deferred();return e.get("/gdc/md/"+t+"/query/metrics").then(function(e){r.resolve(e.query.entries)},r.reject),r.promise()},h=function(t,r){var n=$.Deferred();return e.post("/gdc/md/"+t+"/availablemetrics",{data:JSON.stringify(r)}).then(function(e){n.resolve(e.entries)},n.reject),n.promise()},j=function(t,r){var n=$.Deferred();return e.post("/gdc/md/"+t+"/drillcrosspaths",{data:JSON.stringify(r)}).then(function(e){n.resolve(e.drillcrosspath.links)},n.reject),n.promise()},y=function(t,r){var n=$.Deferred();return e.post("/gdc/md/"+r+"/maqlvalidator").then(function(e){n.resolve(e)},n.reject),n.promise()},b=function(){var t=$.Deferred();return e.get("/gdc/app/account/bootstrap").then(function(e){var r=e.bootstrapResource.current.project.links.self;t.resolve(r.split("/").pop())},t.reject),t.promise()},D=function(t){var r=$.Deferred();return e.get(t,{headers:{Accept:"application/json"},dataType:"json",contentType:"application/json"}).then(function(e){r.resolve(e)},r.reject),r.promise()},x=function(e){var t,r=$.Deferred(),n=function(e){if(e.attribute)return e.attribute.content.displayForms[0].meta.identifier;if(e.dimension)return e.dimension.content.attributes.content.displayForms[0].meta.identifier;if(e.metric)return e.metric.meta.identifier;throw"Unknown object!"};return $.isPlainObject(e)?r.resolve(n(t)):D(e).then(function(e){r.resolve(n(e))},r.reject),r.promise()},w=function(t,r){var n=$.Deferred(),i=function(e){var t=e.attribute?e.attribute:e.metric;return t.meta.uri};return e.ajax("/gdc/md/"+t+"/identifiers",{type:"POST",headers:{Accept:"application/json"},data:{identifierToUri:[r]}}).then(function(e){var t=e.identifiers.filter(function(e){return e.identifier===r});return t[0]?D(t[0].uri):(n.reject("identifier not found"),void 0)},n.reject).then(function(e){return e.attributeDisplayForm?D(e.attributeDisplayForm.content.formOf).then(function(e){n.resolve(i(e))},n.reject):n.resolve(i(e))},n.reject),n.promise()};return{DEFAULT_PALETTE:r,isLoggedIn:i,login:o,logout:a,getProjects:u,getDatasets:c,getColorPalette:s,setColorPalette:f,getData:l,getAttributes:d,getFolders:m,getFoldersWithItems:g,getDimensions:p,getMetrics:v,getAvailableMetrics:h,getAvailableAttributes:j,validateMaql:y,getReportDefinition:n,getCurrentProjectId:b,getObjectDetails:D,getObjectIdentifier:x,getObjectUri:w}}),e("gooddata",["xhr","sdk"],function(e,t){return t.xhr=e,t}),t("gooddata")});